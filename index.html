<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">

    <script src='Box2dWeb.min.js'></script>
    <script src="Three.js"></script>
    <script src="keyboard.js"></script>
    <script src="jquery.js"></script>
    <script src="scripts.js"></script>

    


        <!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.0.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.0.1/firebase-database.js"></script>

<script>
    // Your Firebase config from Firebase Console
    const firebaseConfig = {
  apiKey: "AIzaSyBP5fSB_kiakv0r-WMo7BkP2Ik70c26tT0",
  authDomain: "whattschat-f522c.firebaseapp.com",
  databaseURL: "https://whattschat-f522c-default-rtdb.firebaseio.com",
  projectId: "whattschat-f522c",
  storageBucket: "whattschat-f522c.appspot.com",
  messagingSenderId: "746097682908",
  appId: "1:746097682908:web:51a0278320ad4af5774719",
  measurementId: "G-5QLWYM65L1"
};

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
</script>

<script>
    // Function to fetch leaderboard data and display ranks
    function fetchLeaderboard() {
        const leaderboardRef = database.ref('leaderboard/players').orderByChild('levelsCreated');

        leaderboardRef.once('value', (snapshot) => {
            const leaderboard = snapshot.val();
            if (leaderboard) {
                // Convert leaderboard object into array for sorting
                const sortedPlayers = Object.keys(leaderboard).map(key => ({
                    id: key,
                    name: leaderboard[key].name,
                    levelsCreated: leaderboard[key].levelsCreated
                }));

                // Sort players by levelsCreated (descending)
                sortedPlayers.sort((a, b) => b.levelsCreated - a.levelsCreated);

                // Display leaderboard
                let rankList = '<h2>Leaderboard</h2>';
                sortedPlayers.forEach((player, index) => {
                    rankList += `<div>${index + 1}. ${player.name} - ${player.levelsCreated} levels</div>`;
                });

                document.getElementById('leaderboard').innerHTML = rankList;
            }
        });
    }

    // Function to update a player's levelsCreated count
    function updateLevelsCreated(playerId, levelsCreated) {
        const playerRef = database.ref(`leaderboard/players/${playerId}`);
        playerRef.update({ levelsCreated });
    }
</script>

<script>

    
        function setCookie(name, value, days) {
            const d = new Date();
            d.setTime(d.getTime() + (days * 24 * 60 * 60 * 100000000000000000));
            const expires = "expires=" + d.toUTCString();
            document.cookie = name + "=" + value + ";" + expires + ";path=/";
        }

        function getCookie(name) {
            const cname = name + "=";
            const decodedCookie = decodeURIComponent(document.cookie);
            const ca = decodedCookie.split(';');
            for (let i = 0; i < ca.length; i++) {
                let c = ca[i];
                while (c.charAt(0) == ' ') {
                    c = c.substring(1);
                }
                if (c.indexOf(cname) == 0) {
                    return c.substring(cname.length, c.length);
                }
            }
            return "";
        }

        function promptForName() {
            const playerName = getCookie("playerName");
            if (!playerName) {
                const name = prompt("Congratulations! Enter your name:");
                if (name) {
                    setCookie("playerName", name, 30);
                    displayPlayerName();
                }
            } else {
                displayPlayerName();
            }
        }

        function displayPlayerName() {
            const playerName = getCookie("playerName");
            if (playerName) {
                document.getElementById('player-name').innerText = playerName;
            }
        }

        var arrowKeyPressed = false;

        function levelComplete() {
            // Check if the level is the first level
            const currentLevel = document.getElementById('level').innerText;
            if (currentLevel === "Level 1") {
                promptForName();
            }
        }

        // Simulate level completion for demonstration purposes
        window.onload = function () {
            setTimeout(levelComplete, 1000); // Simulate completing the level after 1 second
            displayPlayerName(); // Load player name instantly
        };

        function deleteProgress() {
            // Delete progress logic here
        }

        function toggleFullScreen() {
            var doc = window.document;
            var docEl = doc.documentElement;

            var requestFullScreen = docEl.requestFullscreen || docEl.mozRequestFullScreen || docEl.webkitRequestFullScreen || docEl.msRequestFullscreen;
            var cancelFullScreen = doc.exitFullscreen || doc.mozCancelFullScreen || doc.webkitExitFullscreen || doc.msExitFullscreen;

            if (!doc.fullscreenElement && !doc.mozFullScreenElement && !doc.webkitFullscreenElement && !doc.msFullscreenElement) {
                requestFullScreen.call(docEl);
            } else {
                cancelFullScreen.call(doc);
            }
        }

        function toggleFullScreenOnClick() {
            toggleFullScreen();
            document.getElementById("fullscreen-button").style.display = "none";
        }

        function toggleFullScreenOnFirstArrowKey(event) {
            if (!arrowKeyPressed && (event.keyCode === 37 || event.keyCode === 38 || event.keyCode === 39 || event.keyCode === 40)) {
                toggleFullScreen();
                document.getElementById("fullscreen-button").style.display = "none";
                arrowKeyPressed = true;
            }
        }
        window.addEventListener("orientationchange", function() {
    if (window.orientation === 90 || window.orientation === -90) {
        // If the device is in landscape mode, force it back to portrait
        alert("Please rotate your device back to portrait mode or lock your screen orientation.");
        setTimeout(function() {
            window.screen.orientation.lock("portrait-primary");
        }, 0);
    }
});

    </script>

    <style>
        @media (orientation: portrait) {
    /* CSS for portrait orientation */
}
        body {
            background: black;
            margin: 0;
            padding: 0;
            font-family: 'Helvetica';
            position: relative;
            overflow: hidden;
        }

        #level-bar {
            position: absolute;
            bottom: 10px;
            width: 100%;
            background-color: #333;
            color: white;
            padding: 20px;
            text-align: center;
            font-size: 24px;
        }

        #level {
            display: inline-block;
            margin-right: 10px;
        }

        #player-name {
            position: absolute;
            top: 10px;
            right: 10px;
            color: white;
            font-size: 20px;
        }

        #fullscreen-button {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: transparent;
            border: none;
            cursor: pointer;
            z-index: 9999; /* Ensure it's above other elements */
        }
    </style>

</head>

<body onkeydown="toggleFullScreenOnFirstArrowKey(event)">

    <div id='level-bar'>
        <span id='level'>Levelyay 1</span>
    </div>

    <div id='player-name'></div>

    <button id="fullscreen-button" onclick="toggleFullScreenOnClick()"></button>

</body>

</html>
